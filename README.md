# STRV subscription Service

The STRV subscription Service is a service designed to allow users to create and send subscriptions. It is primarily built using Go and leverages Firebase's Firestore and PostgreSQL for database management and AWS Simple Email Service (SES) for sending emails.

## Project Structure

The project is organized in the following manner:

- `api`: Contains the API endpoints and the HTTP server.
- `config`: Contains the configurations required for the service.
- `docs`: Contains documentation related to the service (OpenAPI).
- `middleware`: Contains middleware functions.
- `model`: Contains the data models.
- `repository`: Contains the code to interact with the database.
- `service`: Contains business logic of the service.

## Endpoints

### User

- `POST /user/signup` : Sign up a new user by providing an email address and a password. The service returns a JWT token that the user can use to authenticate subsequent requests.
- `POST /user/login` : Log in an existing user by providing an email address and a password. The service returns a JWT token.

### Subscription

- `POST /subscription/create` : Create a new subscription. Requires JWT authentication. The subscription is stored in the Firestore database.
- `POST /subscription/{id}/send` : Send a created subscription. Requires JWT authentication. The service sends the subscription to the email addresses of all subscribers.
- `GET /subscription/{id}/subscribe` : Subscribe a user to the subscription service by providing an email address. The user's email address is added to the Firestore database.
- `GET /subscription/{id}/unsubscribe` : Unsubscribe a user from the subscription service by providing an email address. The user's email address is removed from the Firestore database.

## Environment Variables

Here are the descriptions for each of the environment variables used in this project:

- `SERVER_PORT`: This variable sets the port number on which the application server runs. For example, if you set `SERVER_PORT=8080`, the application will run on port 8080.

- `DATABASE_DSN`: This variable is the Data Source Name for the database. It provides the information needed to connect to the database. In this case, it appears to be configured for a PostgreSQL database and contains information such as the host (where the database is located), the user (the username used to connect to the database), the password (the password used to authenticate the user), the dbname (the name of the database to connect to), and sslmode (whether or not to use SSL).

- `FIREBASE_JSON`: This variable contains JSON that includes your Firebase project's credentials that are needed to authenticate with Firebase.

- `AWS_REGION`: This variable sets the AWS region that your application will interact with. For example, if your AWS resources (like your SES email service) are located in the North Europe region, you would set `AWS_REGION=eu-north-1`.

- `JWT_SECRET`: This variable is the secret used to sign the JWTs (JSON Web Tokens) generated by the application. It is important to keep this secret secure as it can be used to verify the authenticity of the tokens.

- `AWS_ACCESS_KEY_ID` and `AWS_SECRET_ACCESS_KEY`: These variables are your AWS credentials. They are used to authenticate your application's requests to AWS. These should be kept secret.

- `POSTGRES_USER`, `POSTGRES_PASSWORD`, and `POSTGRES_DB`: These variables are used to configure the PostgreSQL database. `POSTGRES_USER` is the username used to connect to the database, `POSTGRES_PASSWORD` is the password used to authenticate the user, and `POSTGRES_DB` is the name of the database to connect to.

These environment variables can be set in a `.env` file in your project root or directly in your environment, depending on how you choose to run the application.

## Building and Running the Project

To build and run the project, you can use the provided Makefile commands:

- `make build` : Builds the Go app.
- `make test` : Runs the tests.
- `make run` : Runs the app.
- `make docker-build` : Builds a Docker image for the app.
- `make docker-run` : Runs the Docker container.
- `make update-docs` : Runs swagger tool to update OpenAPI docs.

You can also build and run the whole project (including local PostgreSQL instance) using docker-compose by running `docker compose up`.

## Contributing

Pull requests are welcome. For major changes, please open an issue first to discuss what you would like to change.

Please make sure to update tests as appropriate.

## License

This project is licensed under the terms of the MIT license.

## Contact

For more information, please contact the project owner.